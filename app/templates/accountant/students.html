{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <h2 class="mb-4">ğŸ“ Manage Students</h2>

  <!-- Search + Filter -->
  <form method="get" class="row g-2 mb-4">
    <div class="col-md-4">
      <input type="text" name="q" placeholder="Search by name or email" value="{{ query }}" class="form-control">
    </div>
    <div class="col-md-3">
      <select name="category" class="form-select">
        <option value="">All Categories</option>
        <option value="General" {% if category_filter=='General' %}selected{% endif %}>General</option>
        <option value="OBC" {% if category_filter=='OBC' %}selected{% endif %}>OBC</option>
        <option value="SC" {% if category_filter=='SC' %}selected{% endif %}>SC</option>
        <option value="ST" {% if category_filter=='ST' %}selected{% endif %}>ST</option>
      </select>
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100" type="submit">Filter</button>
    </div>
    <div class="col-md-3 text-end">
      <a href="{{ url_for('accountant.dashboard') }}" class="btn btn-secondary">â† Back to Dashboard</a>
    </div>
  </form>

  <!-- Student Table -->
  <div class="card shadow-sm">
    <div class="card-body">
      {% if students %}
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Category</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for s in students %}
          <tr>
            <td>{{ s.name }}</td>
            <td>{{ s.email }}</td>
            <td>{{ s.category }}</td>
            <td>{{ s.created_at.strftime('%d-%b-%Y') if s.created_at else 'N/A' }}</td>
            <td>
              <a href="{{ url_for('accountant.edit_student', student_id=s._id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
              <form action="{{ url_for('accountant.delete_student', student_id=s._id) }}" method="POST" style="display:inline;"
                onsubmit="return confirm('Delete this student permanently?');">
                <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-muted">No students found.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
